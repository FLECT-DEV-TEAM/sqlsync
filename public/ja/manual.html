<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>SQLSync - 使い方</title>
	<link rel="stylesheet" type="text/css" media="screen" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/themes/redmond/jquery-ui.css" />
	<link rel="stylesheet" media="screen, print" href="../javascripts/ext/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" media="screen" href="../stylesheets/main.css">
	<link rel="shortcut icon" type="image/png" href="../images/favicon.png">
	<script src="../javascripts/jquery-1.9.0.min.js" type="text/javascript"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
	<script src="../javascripts/ext/bootstrap/js/bootstrap.min.js"></script>
<style>
body {
	padding: 40px;
}
.navbar-inverse .brand {
  color: #FFFFFF;
}
</style>
</head>
<body>
<div id="header" class="navbar navbar-inverse navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container-fluid">
			<span class="brand" class="active">SQLSync</span>
			<ul class="nav">
				<li><a href="/">メイン</a></li>
			</ul>
		</div>
	</div>
</div>
<a href="https://github.com/shunjikonishi/sqlsync"><img style="position: absolute; top: 0; right: 0; border: 0;z-index: 9999;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
<div class="container">
<div>
<h2>SQLSyncとは</h2>
<p>
毎日指定時間に登録したSELECT文を実行してその結果をSalesforceにBulkでUpsertするツールです。
</p>
<p>
実行するSELECT文には前回の実行日時がパラメータとして渡されるので更新日時を比較して毎日夜間にRDB上のデータをSalesforceに取り込むような使い方ができます。
</p>
</div>
<div>
<h2>画面構成</h2>
<h3>同期SQL一覧</h3>
<p>
画面上部には登録した同期SQLがテーブル表示されます。
</p>
<p>
同期SQLには以下の項目があります。
</p>
<table class="table table-striped table-bordered">
	<tr>
		<th>名前</th>
		<td>ユニークな名前</td>
	</tr>
	<tr>
		<th>説明</th>
		<td>任意の説明</td>
	</tr>
	<tr>
		<th>オブジェクト名</th>
		<td>同期対象のSalesforceオブジェクト</td>
	</tr>
	<tr>
		<th>外部ID</th>
		<td>Upsertで使用する外部ID</td>
	</tr>
	<tr>
		<th>前回対象日時</th>
		<td>前回同期処理を実行した際にパラメータとして使用した日時</td>
	</tr>
	<tr>
		<th>次回対象日時</th>
		<td>
			次回同期処理を実行する際にパラメータとして使用する日時<br>
			(直近の実行時の日時が設定されます。)
		</td>
	</tr>
	<tr>
		<th>ステータス(※)</th>
		<td>Bulk処理のステータス前回同期処理を実行した際にパラメータとして使用した日時</td>
	</tr>
	<tr>
		<th>メッセージ(※)</th>
		<td>Bulk処理でエラーが発生した場合のエラーメッセージ</td>
	</tr>
</table>
<div class="memo">
	<p><em>※注意</em></p>
	<p>ステータスとメッセージで確認できるのは「Bulk処理のリクエスト」に成功したかどうかまでです。</p>
	<p>実際にどのように処理が行われたかを確認するためにはSalesforceの「設定 ＞ 監視 ＞ 一括データ読み込みジョブ」の画面で確認してください。</p>
</div>
<h3>スケジュール時刻</h3>
<p>
デイリーで同期処理を実行する時刻を設定します。
</p>
<h3>同期ジョブ状態確認</h3>
<p>
Salesforceの一括データ読み込みジョブ画面を開きます。
</p>
<h3>項目設定エリア</h3>
<p>
同期SQL一覧で選択した行の情報がここに表示されます。
</p>
<table class="table table-striped table-bordered">
	<tr>
		<th>名前</th>
		<td>必須</td>
		<td>ユニークな名前。</td>
	</tr>
	<tr>
		<th>説明</th>
		<td></td>
		<td>任意の説明</td>
	</tr>
	<tr>
		<th>SQL</th>
		<td>必須</td>
		<td>同期で使用するSQL。書式は後述</td>
	</tr>
	<tr>
		<th>オブジェクト名</th>
		<td>必須</td>
		<td>同期対象のSalesforceオブジェクト</td>
	</tr>
	<tr>
		<th>外部ID</th>
		<td>必須</td>
		<td>Upsertで使用する外部ID</td>
	</tr>
	<tr>
		<th>対象日時</th>
		<td></td>
		<td>
			SQLテスト実行、または手動での同期実行での対象日時
		</td>
	</tr>
</table>
<h4>更新ボタン</h4>
<p>
画面上で修正した内容でデータが更新されます。
</p>
<p>
「対象日時」は更新されません。
</p>
<h4>削除ボタン</h4>
<p>
同期SQL一覧で選択中の行が削除されます。
</p>
<h4>新規登録ボタン</h4>
<p>
画面上の内容でデータを新規登録します。
</p>
<h3>SQLテスト実行</h3>
<p>
画面上に表示されているSQLを対象時刻をパラメータにして実行し結果をテーブル形式で表示します。
</p>
<h3>同期実行</h3>
<p>
手動で同期処理を指定の対象時刻で実行します。
</p>
<p>
同期実行は同期SQLが登録され画面上で変更されていない状態でしか実行できません。
</p>
</div>
<div>
<h2>SQLの書式</h2>
<p>
同期SQLとして登録可能なSQLの要件は以下です。
</p>
<ul>
<li>SELECT句に指定する全てのカラムにエイリアスとしてSalesforceのフィールド名が指定されていること</li>
<li>SELECT句に外部IDフィールドが含まれていること</li>
<li>WHERE句に日付時刻型のパラメータがひとつだけ含まれていること</li>
</ul>
<p>
以下に例を示します。
</p>
<pre>
SELECT ID AS EXID__C,
       NAME AS NAME,
       DESCRIPTION AS DESCRIPTION__C
  FROM TABLE1
 WHERE UPDATE_DATE > ?       
</pre>
<p>
このようにSELECT文を指定することでSELECTした各フィールドがエイリアスに指定したSalesforceのフィールドに取り込まれます。
</p>
<h3>参照フィールドを外部IDで指定したい場合</h3>
<p>
更新するオブジェクトに親オブジェクトがあり、そのレコードを外部IDを使用して指定する場合は以下のようにエイリアスに「&lt;親オブジェクト名&gt;.&lt;親オブジェクトの外部ID&gt;」を「"」で括って指定します。
</p>
<pre>
SELECT ID AS EXID__C,
       NAME AS NAME,
       <em>PARENT_ID AS "PARENT__C.EXID__C"</em>,
       DESCRIPTION AS DESCRIPTION__C
  FROM TABLE1
 WHERE UPDATE_DATE > ?       
</pre>
</div>
<div>
<h2>実行の監視</h2>
<p>
Papertrail等のログ監視アドオンを入れて「BulkStatus」をメール通知すればデイリーの処理が成功したかどうかはわかります。
</p>
<p>
ただし、先にも述べたとおり実際に何件のデータが更新に成功あるいは失敗したかを知るためにはSalesforceの一括データ読み込みジョブ画面を見る必要があります。
</p>
</div>
</div>
</body>
</html>
